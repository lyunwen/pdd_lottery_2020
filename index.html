<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title></title>
    <link rel="stylesheet" type="text/css" href="wwwroot/css.css">
</head>

<body>
    <div class="content">
        <div class="draw-area">
            <div class="draw-round-top">
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
            </div>
            <div class="draw-round-content">
                <div class="draw-round-left">
                    <div class="draw-round-cell"></div>
                    <div class="draw-round-cell"></div>
                    <div class="draw-round-cell"></div>
                    <div class="draw-round-cell"></div>
                    <div class="draw-round-cell"></div>
                </div>
                <div class="draw-round-show">
                    <div class="draw-round-show-inner">
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                        <div class="draw-round-people">
                            <div class="draw-round-people-img"></div>
                            <div class="draw-round-people-name">v_joycemma</div>
                        </div>
                    </div>
                </div>
                <div class="draw-round-right">
                    <div class="draw-round-cell"></div>
                    <div class="draw-round-cell"></div>
                    <div class="draw-round-cell"></div>
                    <div class="draw-round-cell"></div>
                    <div class="draw-round-cell"></div>
                </div>
            </div>
            <div class="draw-round-buttom">
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
                <div class="draw-round-cell"></div>
            </div>
        </div>

        <div class="draw-count">
            <div class="count-description"></div>
            <div class="count-kscount count-kscount-cz">2/33</div>
            <div class="count-kscount count-kscount-hl"></div>
            <div class="count-kscount count-kscount-kl"></div>
            <div class="count-kscount count-kscount-zc"></div>
            <div class="count-kscount count-kscount-fx"></div>
            <div class="count-kscount count-kscount-jt"></div>
            <div class="count-kscount count-kscount-xz"></div>
            <div class="count-kscount count-kscount-zz"></div>
            <div class="count-kscount count-kscount-jk"></div>
            <div class="count-kscount count-kscount-jq"></div>
        </div>
    </div>
</body>

</html>
<script type="text/javascript" src="../2020年会抽奖/wwwroot/peoples.js"></script>
<script type="text/javascript" src="../2020年会抽奖/wwwroot/jquery-1.7.2.min.js"></script>
<script type="text/javascript">
    $(function () {
        let currentGroups = ["创造研究员", "佛系研究员"];
        let thisPeoples = [{ group: "", name: "", isDraw: false, DrawRound: 0 }];
        thisPeoples = peoples;

        /*-------------------init begin-------------------*/
        initKsPool();//初始化科室池
        keyEventInit();//事件绑定
        bindUI();//页面数据绑定
        /*-------------------init end-------------------*/

        /*-------------------科室操作 begin-------------------*/

        //清空科室池
        function emptyKsPool() {
            currentGroups = [];
            console.log("清空科室池");
        }
        //初始化科室池，加载所有可抽奖科室
        function initKsPool() {
            currentGroups = new Array();
            for (let i = 0; i < thisPeoples.length; i++) {
                if (thisPeoples[i].isDraw == false) {
                    if (currentGroups.find(x => x == thisPeoples[i].group) == null) {
                        currentGroups.push(thisPeoples[i].group)
                        continue
                    }
                }
            }
            console.log("初始化科室池，当前参与抽奖科室:" + currentGroups + ";" + currentGroups.length + "个");
        }
        //添加一个可抽奖科室到科室池
        function addOneToksPool() {
            let undrawGroups = [];
            for (let i = 0; i < thisPeoples.length; i++) {
                if (thisPeoples[i].isDraw == false) {
                    if (undrawGroups.find(x => x == thisPeoples[i].group) == null && currentGroups.find(x => x == thisPeoples[i].group) == null) {
                        undrawGroups.push(thisPeoples[i].group)
                        continue
                    }
                }
            }
            if (undrawGroups.length > 0) {
                let luckyGroup = undrawGroups[getLuckyNumber(0, undrawGroups.length - 1)];
                currentGroups.push(luckyGroup)
                console.log("添加一个科室池，当前参与抽奖科室:" + currentGroups + ";" + currentGroups.length + "个");
            } else {
                console.log("添加一个科室池，失败：" + currentGroups + ";" + currentGroups.length + "个");
            }
        }

        /*-------------------科室操作 end-------------------*/
        let currentAction = "";//r:标识抽人
        let currentNum = "";
        function keyEventInit() {
            $(document).keydown(
                function (event) {
                    if (event.ctrlKey && event.keyCode == 13) {
                        switch (currentAction) {
                            case "r":
                                console.log("开始抽" + currentNum + "个人")
                                getLuckyPeoples(parseInt(currentNum))
                                break;
                        }
                    };
                    switch (event.keyCode) {
                        //r
                        case 82: currentAction = "r"; currentNum = ""; console.log("准备抽人"); break;

                        case 96: currentNum = currentNum + "0"; console.log("当前数量" + currentNum); break;
                        case 97: currentNum = currentNum + "1"; console.log("当前数量" + currentNum); break;
                        case 98: currentNum = currentNum + "2"; console.log("当前数量" + currentNum); break;
                        case 99: currentNum = currentNum + "3"; console.log("当前数量" + currentNum); break;
                        case 100: currentNum = currentNum + "4"; console.log("当前数量" + currentNum); break;
                        case 101: currentNum = currentNum + "5"; console.log("当前数量" + currentNum); break;
                        case 102: currentNum = currentNum + "6"; console.log("当前数量" + currentNum); break;
                        case 103: currentNum = currentNum + "7"; console.log("当前数量" + currentNum); break;
                        case 104: currentNum = currentNum + "8"; console.log("当前数量" + currentNum); break;
                        case 105: currentNum = currentNum + "9"; console.log("当前数量" + currentNum); break;


                        case 73://I 初始化科室
                            initKsPool();
                            break;
                        case 75: //K 添加一个科室
                            addOneToksPool();
                            break;
                        case 76://L 清空科室
                            emptyKsPool();
                            break;

                            case 85://u 绑定数据
                            bindUI();
                            break;
                    }; return false;
                });
        }
        /*-------------------人员操作 begin-------------------*/
        //private 获取未抽中人
        function getUndrawPeoples() {
            return thisPeoples.filter(x => (x.isDraw == false && currentGroups.find(y => y == x.group) != null));
        }
        //获取多个幸运儿
        function getLuckyPeoples(count) {
            let luckyNames = new Array();
            for (let i = 0; i < count; i++) {
                luckyNames.push(getLuckyPeople());
            }
            bindUI();
            return luckyNames;
        }
        //private 获取一个幸运儿
        function getLuckyPeople() {
            let undrawPeoples = getUndrawPeoples();
            let luckyPeople = undrawPeoples[getLuckyNumber(0, undrawPeoples.length - 1)];
            console.log("抽中 Name:" + luckyPeople.name + " Group:" + luckyPeople.group)
            setDrawedPeople(luckyPeople.name);
            return luckyPeople.name;
        }
        //private 设置为已中奖状态
        function setDrawedPeople(name) {
            for (let i = 0; i < thisPeoples.length; i++) {
                if (thisPeoples[i].name == name) {
                    thisPeoples[i].isDraw = true;
                }
            }
        }

        /*-------------------人员操作 end-------------------*/



        /*-------------------其他操作 begin-------------------*/
        //private 获取随机数
        function getLuckyNumber(Min, Max) {
            var Range = Max - Min;
            var Rand = Math.random();
            var num = Min + Math.round(Rand * Range);
            return num;
        }

        function bindUI() {
            let allCz = 0;
            let drawedCz = 0;
            let allHl = 0;
            let drawedHl = 0;
            let allKl = 0;
            let drawedKl = 0;
            let allZc = 0;
            let drawedZc = 0;
            let allFx = 0;
            let drawedFx = 0;
            let allJt = 0;
            let drawedJt = 0;
            let allXz = 0;
            let drawedXz = 0;
            let allZz = 0;
            let drawedZz = 0;
            let allJk = 0;
            let drawedJk = 0;
            let allJq = 0;
            let drawedJq = 0;
            thisPeoples.forEach(people => {
                switch (people.group) {
                    case "创造研究员":
                        allCz++;
                        people.isDraw ? drawedCz++ : drawedCz + 0; break;
                    case "活力研究员":
                        allHl++;
                        people.isDraw ? drawedHl++ : drawedHl + 0; break;
                    case "快乐研究员":
                        allKl++;
                        people.isDraw ? drawedKl++ : drawedKl + 0; break;
                    case "真诚研究员":
                        allZc++;
                        people.isDraw ? drawedZc++ : drawedZc + 0; break;
                    case "佛系研究员":
                        allFx++;
                        people.isDraw ? drawedFx++ : drawedFx + 0; break;
                    case "鸡汤研究员":
                        allJt++;
                        people.isDraw ? drawedJt++ : drawedJt + 0; break;
                    case "协作研究员":
                        allXz++;
                        people.isDraw ? drawedXz++ : drawedXz + 0; break;
                    case "正直研究员":
                        allZz++;
                        people.isDraw ? drawedZz++ : drawedZz + 0; break;
                    case "健康研究员":
                        allJk++;
                        people.isDraw ? drawedJk++ : drawedJk + 0; break;
                    case "进取研究员":
                        allJq++;
                        people.isDraw ? drawedJq++ : drawedJq + 0; break;
                        default:console.log("科室类型异常"+people);
                }
            })
            $(".count-kscount-cz").text(drawedCz+"/"+allCz)
            $(".count-kscount-hl").text(drawedHl+"/"+allHl)
            $(".count-kscount-kl").text(drawedKl+"/"+allKl)
            $(".count-kscount-zc").text(drawedZc+"/"+allZc)
            $(".count-kscount-fx").text(drawedFx+"/"+allFx)
            $(".count-kscount-jt").text(drawedJt+"/"+allJt)
            $(".count-kscount-xz").text(drawedXz+"/"+allXz)
            $(".count-kscount-zz").text(drawedZz+"/"+allZz)
            $(".count-kscount-jk").text(drawedJk+"/"+allJk)
            $(".count-kscount-jq").text(drawedJq+"/"+allJq)
            console.log("绑定界面数据")
        }
        //getLuckyPeoples(2);

        /*-------------------其他操作 end-------------------*/
    })
</script>